<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.javbus.spider.spider.dao.base.MovieDao">
    <!-- movieResultMap.xml -->
    <resultMap id="movieResultMap" type="com.javbus.spider.spider.entity.base.Movie">
        <id property="id" column="id" />
        <result property="code" column="code" />
        <result property="title" column="title" />
        <result property="releaseDate" column="release_date" />
        <result property="length" column="length" />
        <result property="link" column="link" />
        <result property="isCensored" column="is_censored" />
    </resultMap>
    
    <!-- 插入电影记录 -->
    <insert id="saveMovie" parameterType="com.javbus.spider.spider.entity.base.Movie"> 
        INSERT INTO movie (code, title, release_date, length, link, is_censored) 
        VALUES (#{code}, #{title}, #{releaseDate}, #{length}, #{link}, #{isCensored}) 
    </insert>

    <!-- 删除电影记录 -->
    <delete id="deleteMovie" parameterType="Integer"> 
        DELETE FROM movie WHERE id = #{id} 
    </delete>

    <!-- 更新电影记录 -->
    <update id="updateMovie" parameterType="com.javbus.spider.spider.entity.base.Movie"> 
        UPDATE movie 
        SET code = #{code}, 
            title = #{title}, 
            release_date = #{releaseDate}, 
            length = #{length}, 
            link = #{link}, 
            is_censored=#{isCensored} 
        WHERE id = #{id} 
    </update>

    <!-- 批量更新电影信息 -->
    <update id="updateMovies" parameterType="java.util.List">
        <foreach collection="movies" item="movie" separator=";">
            UPDATE movie
            SET 
                code = #{movie.code},
                title = #{movie.title},
                release_date = #{movie.releaseDate},
                length = #{movie.length},
                link = #{movie.link},
                is_censored = #{movie.isCensored}
            WHERE id = #{movie.id}
        </foreach>
    </update>


    <!-- 更新电影记录（根据code） -->
    <update id="updateMovieByCode" parameterType="com.javbus.spider.spider.entity.base.Movie"> 
        UPDATE movie 
        SET code = #{code}, 
            title = #{title}, 
            release_date = #{releaseDate}, 
            length = #{length}, 
            link = #{link}, 
            is_censored=#{isCensored} 
        WHERE code = #{code} 
    </update>

    <!-- 查询电影（根据code） -->
    <select id="queryMovieByCode" parameterType="java.lang.String" resultMap="movieResultMap"> 
        SELECT * FROM movie WHERE code=#{code} 
    </select>

    <select id="queryMovieCodes" resultType="java.lang.String"> 
        SELECT code FROM movie WHERE is_censored=#{isCensored} LIMIT #{pageSize} OFFSET #{offset} 
    </select>
    <!-- 查询电影（根据title） -->
    <select id="queryMovieByTitle" parameterType="java.lang.String" resultMap="movieResultMap"> 
        SELECT * FROM movie WHERE title=#{title} 
    </select>

    <!-- 查询电影（根据id） -->
    <select id="queryMovieById" parameterType="java.lang.Integer" resultMap="movieResultMap"> 
        SELECT * FROM movie WHERE id=#{id} 
    </select>
        <!-- 查询电影（根据id） -->
    <select id="queryMovieByLink" parameterType="java.lang.String" resultMap="movieResultMap"> 
        SELECT * FROM movie WHERE link=#{link} 
    </select>
</mapper>
